function preload(){var n=getURLParams();imgNumber=n.img;imgNumber==undefined&&(imgNumber="theshining");isDebug=n.debug==undefined?!1:!0;n.step!=undefined&&(stepSizeInit=int(n.step));n.noiseMode!=undefined&&(noiseMode=int(n.noiseMode));n.curveMode!=undefined&&(curveMode=int(n.curveMode));capture=loadImage("../media/"+imgNumber+".jpg");capturePixels=loadImage("../media/"+imgNumber+".jpg")}function setup(){createCanvas(windowWidth,windowHeight);background(0);capturePixels.loadPixels();slider=createSlider(4,32,stepSizeInit);isDebug?slider.position(20,20):slider.hide();getUserMedia()==!0?(mic=new p5.AudioIn,mic.start(),amp=new p5.Amplitude,amp.toggleNormalize(!0),amp.smooth(.95),amp.setInput(mic)):console.debug("getUserMedia is not supported.")}function draw(){var v=capture.width/windowWidth,y=capture.height/windowHeight,n,t,i,w,a;noStroke();fill(0,0,0,100);rect(0,0,width,height);mic!==undefined&&(scale=map(amp.getLevel(),0,1,10,width));var c=slider.value(),u=300,d=pixelDensity(),f=round(mouseX*v),e=round(mouseY*y);for(n=e-u*4;n<e+u;n+=c)for(t=f-u;t<f+u;t+=c){i=1;switch(noiseMode){case 1:i+=noise(t,n,millis());break;case 2:i+=0;break;case 3:i+=noise(sin(millis()),millis())}var b=round(u/2*i),g=t-f,nt=n-e,r=distanceF(t,n,f,e,b,i,millis()*i);if(r<=1){var l=4*(n*capture.width+t),o=capturePixels.pixels[l],p=capturePixels.pixels[l+1],s=capturePixels.pixels[l+2],k=255*(1-smoothstep(0,1,r)),h=0;r>.75&&(w=s,s=o*smoothstep(0,1,r),o=w*smoothstep(0,1,r));h=sqrt(.299*o^2+.587*p^2+.114*s^2);h=h*i*smoothstep(0,1,r);a=c*constrain(h/10,1,2);fill(color(o,p,s,k));ellipse(t/v,n/y,a,a)}}}function smoothstep(n,t,i){var r=Math.max(0,Math.min(1,(i-n)/(t-n)));return r*r*(3-2*r)}function distanceF(n,t,i,r,u,f,e){var s,o,h,c,l,a,v;switch(curveMode){case 1:return s=sq(f*(n-i))+f*sq(t-r),s/sq(u);case 2:return n=n+f*5*(2*sin(e/300)-1)*(t-r)/r,s=sq(1.8*(n-i))+sq(t-r+.9*u),o=atan2(50*(i-n),2.5*(r-t)),o=o+PI,h=7,c=sq(1.1*u*(cos(o)-1))+sq(u*sin(o)*pow(sin(.5*o),h)),n=n+f*5*(2*sin(e/250)-1)*(t-r)/r,s=sq(1.8*(n-i))+sq(t-r+.9*u),o=atan2(50*(i-n),2*(r-t)),o=o+PI,h=7,l=sq(1.1*u*(cos(o)-1))+sq(u*sin(o)*pow(sin(.5*o),h)),n=n+f*5*(2*sin(e/400)-1)*(t-r)/r,s=sq(1.8*(n-i))+sq(t-r+.9*u),o=atan2(40*(i-n),2.8*(r-t)),o=o+PI,h=7,a=sq(1.1*u*(cos(o)-1))+sq(u*sin(o)*pow(sin(.5*o),h)),v=Math.max(c,l,a),s/v;default:return!1}}function getUserMedia(){return!!window.MediaStreamTrack}function windowResized(){resizeCanvas(windowWidth,windowHeight)}var isDebug=!1;document.ontouchmove=function(n){isDebug==!1&&n.preventDefault()};var windowH_L,windowW_L,mic,amp,scale=1,capture,capturePixels,slider,stepSizeInit=6,noiseMode=1,curveMode=1;